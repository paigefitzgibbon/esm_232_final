---
title: "ESM_232_SnowMelt_Model_Colon_Holmes"
author: "Mario Colon"
date: "June 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

###Library Load

```{r}

library(tidyverse)

```
###Load in data

```{r}

snow_inputs <- read_csv("Inputs.csv")

view(snow_inputs)

```

###Load three models

```{r}

source("model_1_warm.R")
source("model_2_ripe.R")
source("model_3_output.R")

```


##Model 1 - Warming Phase

```{r}

warm <- snow_warm(hm = snow_inputs$SWECM, Ts = snow_inputs$`snow surface temperatureC`, ci = 2101, pw = 1000, Tm = 0)

warm = as.data.frame(warm)

warm$time = c(seq(from = 1, to = 696))

warm

ggplot(warm, aes(time, warm)) + 
  geom_line(col = "purple") +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Warming Phase")



```


##Model 2 - Ripening Phase

```{r}

ripe <- snow_ripe(hs = snow_inputs$`snow depthCM`, theta_ret = 0.03, pw = 1000, lambda = 0.334)

ripe = as.data.frame(ripe)

ripe$time = c(seq(from = 1, to = 696))

ripe


ggplot(ripe, aes(time, ripe)) + 
  geom_line(col = "cyan") +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Ripeing Phase")

```


##Model 3 - Output Phase 

```{r}


output <- snow_output(hm = snow_inputs$SWECM, hwret = 0.03, pw = 1000, lambda = 0.334)

output = as.data.frame(output)

output$time = c(seq(from = 1, to = 696))

output

ggplot(output, aes(time, output)) + 
  geom_line(col = "purple") +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Output Phase")

```

###Energy Combination 

```{r}

combination_warm_ripe <- merge(warm, ripe, by ="time")
final_combo <- merge(combination_warm_ripe, output, by = "time")

final_combo$energy = final_combo$warm + final_combo$ripe + final_combo$output

final_combo

ggplot(final_combo, aes(time, energy)) + 
  geom_line(col = "cyan") +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Overall Snowmelt")

```

###Sensitivity Analysis


##Climate Change 

#Data change i.e. 3 degrees (C) to snow surface temp

```{r}

snow_inputs$temp_low = snow_inputs$`snow surface temperatureC` - 3 
snow_inputs$temp_high = snow_inputs$`snow surface temperatureC` + 3
 
warm_low <- snow_warm(hm = snow_inputs$SWECM, Ts = snow_inputs$temp_low, ci = 2101, pw = 1000, Tm = 0)
warm_high <- snow_warm(hm = snow_inputs$SWECM, Ts = snow_inputs$temp_raise, ci = 2101, pw = 1000, Tm = 0)

warm_low = as.data.frame(warm_low)
warm_high = as.data.frame(warm_high)

warm_low$time = c(seq(from = 1, to = 696))
warm_high$time = c(seq(from = 1, to = 696))

combination_warm <- merge(warm, warm_high, by ="time")
final_combo_warm <- merge(combination_warm, warm_low, by = "time")

final_combo_warm

ggplot(final_combo_warm, aes(time)) + 
  geom_line(aes(y = warm, col = "warm")) +
  geom_line(aes(y = warm_low, col = "warm_low")) +
  geom_line(aes(y = warm_high, col = "warm_high")) +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Warming Phase with +/- 3C") +
  labs(colour = "Scenarios")
  
```


##Depth change 

```{r}

snow_inputs$depth_low = snow_inputs$`snow depthCM` - 50
snow_inputs$depth_high = snow_inputs$`snow depthCM` + 50

ripe_low <- snow_ripe(hs = snow_inputs$depth_low, theta_ret = 0.03, pw = 1000, lambda = 0.334)
ripe_high <- snow_ripe(hs = snow_inputs$depth_high, theta_ret = 0.03, pw = 1000, lambda = 0.334)


ripe_low = as.data.frame(ripe_low)
ripe_high = as.data.frame(ripe_high)

ripe_low$time = c(seq(from = 1, to = 696))
ripe_high$time = c(seq(from = 1, to = 696))

combination_ripe <- merge(ripe, ripe_high, by ="time")
final_combo_ripe <- merge(combination_ripe, ripe_low, by = "time")

final_combo_ripe

ggplot(final_combo_ripe, aes(time)) + 
  geom_line(aes(y = ripe, col = "ripe")) +
  geom_line(aes(y = ripe_low, col = "ripe_low")) +
  geom_line(aes(y = ripe_high, col = "ripe_high")) +
  theme_classic() + 
  ylab("Energy Required (J m-2)") +
  xlab("Time Step") +
  ggtitle("Energy Requirment for Ripeing Phase with +/- 50 cm") +
  labs(colour = "Scenarios")
  



```



